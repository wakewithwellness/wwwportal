<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>WWW-ID Cards</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <link href="../assets/img/favicon.png" rel="icon" />
    <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
      crossorigin="anonymous"
    ></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="./MembersPanel/assets/css/style.css"
    />
  </head>

  <body>
    <!--oncontextmenu="return false"-->

    <div
      class="header"
      style="
        -webkit-box-shadow: 0px 4px 11px 1px rgba(0, 0, 0, 0.33);
        -moz-box-shadow: 0px 4px 11px 1px rgba(0, 0, 0, 0.33);
        box-shadow: 0px 4px 11px 1px rgba(0, 0, 0, 0.33);
        background-color: rgb(53, 53, 53);
        height: 60px;
      "
    >
      <div class="header-left">
        <p class="logo" style="float: left; margin-top: 5px">
          <img src="../assets/img/favicon.png" width="35" height="35" alt="" />
          <span style="color: #fff; text-decoration: hidden"
            >WakeWithWellness</span
          >
        </p>
      </div>
    </div>

    <!-- ======= Header ======= -->
    <!-- End Header -->
    <br />
    <div class="container" style="margin-top: 11vh; text-align: center">
      <h3 style="color: #16151a; font-weight: bold; font-size: 19px">
        ID Card Registration
      </h3>
    </div>

    <div class="container my-2" style="max-width: 100vh">
      <hr />
      <br />
      <br />
      <form id="myForm">
        <div class="form-group">
          <label for="exampleInputEmail1">Name</label>
          <input
            type="text"
            class="form-control"
            id="name"
            name="name"
            placeholder="Enter name"
          />
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Email</label>
          <input
            type="email"
            class="form-control"
            id="email"
            name="email"
            placeholder="Enter email"
          />
          <small class="form-text text-muted"
            >We'll never share your email with anyone else.</small
          >
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Blood group</label>
          <input
            type="text"
            class="form-control"
            id="blood"
            name="blood"
            placeholder="Enter blood group"
          />
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Contact</label>
          <input
            type="tel"
            class="form-control"
            id="contact"
            name="contact"
            placeholder="Enter contact no."
          />
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Contact</label>
          <textarea
            class="form-control"
            id="address"
            name="address"
            placeholder="Enter address"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="exampleFormControlFile1">Signature</label>
          <input
            type="file"
            accept=".jpg,.jpeg,.png,.pdf"
            maxlength="2097152"
            class="form-control-file"
            id="file1"
            name="file1"
          />
        </div>

        <div class="form-group">
          <label for="exampleFormControlFile1">Profile Photo</label>
          <input
            type="file"
            accept=".jpg,.jpeg,.png"
            maxlength="2097152"
            class="form-control-file"
            id="file2"
            name="file2"
          />
        </div>
        <div class="text-center">
          <p style="color: red" id="status"></p>
          <input class="btn btn-secondary" type="submit" value="Submit" />
        </div>
      </form>

      <br />
      <br />
      <br />
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-storage.js"></script>

    <script>
      // Initialize Firebase
      var firebaseConfig = {
        apiKey: "AIzaSyDoiXHxMG_vZPHz0eeJj5s661xhfU-Y4_4",
        authDomain: "members-76725.firebaseapp.com",
        projectId: "members-76725",
        storageBucket: "members-76725.appspot.com",
        messagingSenderId: "734645197873",
        appId: "1:734645197873:web:808127fdb4d643d4d24910",
        measurementId: "G-7LYZ3R48GT",
      };
      firebase.initializeApp(firebaseConfig);

      // Get a reference to the Firestore database
      var db = firebase.firestore();

      // Add an event listener to the form submission
      document
        .getElementById("myForm")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // Prevent the form from submitting

          // Get the form data
          var name = document.getElementById("name").value;
          var email = document.getElementById("email").value;
          var blood = document.getElementById("blood").value;
          var contact = document.getElementById("contact").value;
          var address = document.getElementById("address").value;
          var file1 = document.getElementById("file1").files[0];
          var file2 = document.getElementById("file2").files[0];

          var maxFileSize = 2097152; // 2MB in bytes
          if (file1 && file1.size > maxFileSize) {
            alert("Signature file size exceeds the maximum limit of 2MB.");
            return;
          }
          if (file2 && file2.size > maxFileSize) {
            alert("Profile photo size exceeds the maximum limit of 2MB.");
            return;
          }

          var status = document.getElementById("status");
          status.innerText = "Please wait while uploading...";

          // Create a new document in the "forms" collection
          db.collection("IDCards")
            .add({
              name: name,
              email: email,
              blood: blood,
              contact: contact,
              address: address,
            })
            .then(function (docRef) {
              // Upload the files to Firebase Storage
              var storageRef = firebase.storage().ref();
              var file1Ref = storageRef.child("IDCards/" + docRef.id + "/sign");
              var file2Ref = storageRef.child(
                "IDCards/" + docRef.id + "/photo"
              );
              var file1UploadTask = file1Ref.put(file1);
              var file2UploadTask = file2Ref.put(file2);

              // Wait for both files to be uploaded
              Promise.all([file1UploadTask, file2UploadTask])
                .then(function () {
                  console.log("Form submitted successfully!");
                  status.innerText = "Form submitted successfully!";
                  document.getElementById("myForm").reset();
                })
                .catch(function (error) {
                  console.error("Error uploading files:", error);
                  status.innerText = "Error uploading files.";
                });
            })
            .catch(function (error) {
              status.innerText = "Error submitting form.";
              console.error("Error adding document:", error);
            });
        });
    </script>
  </body>
</html>
